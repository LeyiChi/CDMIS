@model CDMIS.ViewModels.DrugInfoProfileViewModel
<script type="text/javascript" src="../../Scripts/chosen.jquery.min.js"></script>       
<style type="text/css">
    #Redirect
    {
        overflow: hidden;
        width: 100%;
        margin: 0;
        padding: 0;
        list-style: none;
    }
    
    #Redirect li
    {
        float: left;
        margin: 0 5 0 5;
        font-family: \9ED1\4F53;
        font-size: 15px;
        display: inline-block;
    }
    #Redirect a
    {
        float: left;
        position: relative;
        padding: 0 40px;
        height: 0;
        line-height: 30px;
        text-transform: uppercase;
        text-decoration: none;
        color: #fff;
        border-right: 0px solid transparent;
        border-bottom: 30px solid #3D3D3D;
        border-bottom-color: #777\9;
        opacity: .8;
        filter: alpha(opacity=30);
    }
    #Redirect a:hover, #Redirect a:focus
    {
        border-bottom-color: #2ac7e1;
        opacity: 1;
        filter: alpha(opacity=100);
    }
    
    #simplemodal-container
    {
        height: 650px;
        width: 450px;
    }
</style>
<h3 style="font-weight: bold;">
    药物治疗信息</h3>
     <div style="text-align:right">
     <input  type="button" value="添加药物治疗信息" class="btn btn-primary addDrugInfo" style="margin-bottom: 5px"/>
     </div>
<input type="text" id="UId" style="display:none" value="@Model.UserId"/>
<input type="text" style="display:none" value="@ViewBag.MaxOrderNo" id="MaxOrderNo"/>
<table id="DrugInfoList" class="display">
    <thead>
        <tr>
            <th style="display: none;">
                编号 @*对应药嘱子序号*@
            </th>
            <th style="display: none;">
            </th>
            <th style="display: none;">
            </th>
            <th>
                药嘱
            </th>
            <th>
                剂量
            </th>
            <th style="display: none;">
            </th>
            <th>
                剂量单位
            </th>
            <th style="display: none;">
            </th>
            <th style="display: none;">
            </th>
            <th>
                开始时间
            </th>
            <th>
                结束时间
            </th>
            <th style="display: none;">
            </th>
            <th style="display: none;">
            </th>
            <th style="display: none;">
            </th>
            <th style="display: none;">
            </th>
            <th>
                操作
            </th>
            <th>
            </th>
            <th style="display: none;">
            </th>
            <th style="display: none;">
            </th>
        </tr>
    </thead>
    <tbody id="TableBody">
        @if (Model.DrugRecordList.Count > 0)
        {
            foreach (var item in Model.DrugRecordList)
            {            
            <tr>
                <td style="border: 0; display: none">
                    @item.OrderNo
                </td>
                <td style="border: 0; display: none;">
                    @item.OrderSubNo
                </td>
                <td style="border: 0; display: none">
                    @item.OrderClassCode
                </td>
                <td  style="border: 0;">
                    @item.OrderContent
                </td>
                <td  style="border: 0;">
                    @item.Dosage
                </td>
                <td style="border: 0; display: none">
                    @item.DosageUnitsCode
                </td>
                <td  style="border: 0;">
                    @item.DosageUnits
                </td>
                <td  style="border: 0; display: none">
                    @item.AdministrationCode
                </td>
                <td  style="border: 0; display: none">
                    @item.RepeatIndicatorCode
                </td>
                <td  style="border: 0;">
                    @item.StartDateTime
                </td>
                <td  style="border: 0;">
                    @item.StopDateTime
                </td>
                <td style="border: 0; display: none">
                    @item.FreqCounter
                </td>
                <td  style="border: 0; display: none">
                    @item.Frequency
                </td>
                <td  style="border: 0; display: none">
                    @item.FreqInteval
                </td>
                <td  style="border: 0; display: none">
                    @item.FreqIntevalUnitCode
                </td>
                @if (item.IsAllowed == true)
                {
                    <td style="border: 0;">
                        <input type="button" value="编辑" class="btn btn-primary editDrugInfoBtn" />
                    </td>
                    <td  style="border: 0;">
                        <input type="button" value="删除" class="btn btn-primary deleteDrugInfoBtn" />
                    </td>
                }
                else
                {
@*<td width="5%" style="border: 0;">
                        <input type="button" value="编辑" class="btn btn-primary editDrugInfoBtn" disabled="disabled" />
                    </td>
                    <td width="5%" style="border: 0;">
                        <input type="button" value="删除" class="btn btn-primary deleteDrugInfoBtn" disabled="disabled" />
                    </td> *@   
                    <td>
                        无编辑权限
                    </td>
                    <td>
                    </td>                          
                }
                <td style="border: 0; display: none">
                    @item.DeptCode
                </td>
                <td style="border: 0; display: none">
                    @item.OrderCode
                </td>
            </tr>
            }
        }
@* else
        {
            <tr id="NotExist">
                <td style="font-size: 15px;" colspan="9">
                    暂无数据，请添加！
                </td>
            </tr>
            
        }*@
    </tbody>
</table>
@*添加药物治疗信息*@
<div id="addDrugInfoDiv" style="display: none;">
    <div class="modalHeader">
        <span>添加药物治疗信息</span></div>
    <div class="modalContent" style="margin-top: 15px;">
        <div class="form-horizontal" role="form">
            <div class="form-group">
                <label class="col-sm-4 control-label">
                    *药物类型
                </label>
                <div class="col-sm-8">
                    @Html.DropDownListFor(model => model.DrugInfo.OrderClass, Model.DrugTypeList(), new { id = "DrugTypeDropDownList", @class = "form-control add-chosen" })
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-4 control-label">
                    *长期医嘱
                </label>
                <div class="col-sm-2">
                    <input type="radio" class="identity" name="ReptFlag" id="ReptFlagYes" value="1" />
                    <label class="col-sm-1 control-label">
                        是</label>
                </div>
                <div class="col-sm-2">
                    <input type="radio" class="identity" name="ReptFlag" id="ReptFlagNo" value="2" />
                    <label class="col-sm-1 control-label">
                        否</label>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-4 control-label">
                    *药品名称
                </label>
                <div class="col-sm-8">
                    @Html.DropDownListFor(model => model.DrugInfo.OrderCode, Model.DrugNameList(), new { id = "OrderCodeInput", @class = "form-control add-chosen" })
                    @* @Html.TextBoxFor(model => model.DrugInfo.OrderContent, new { id = "OrderContentInput", @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.DrugInfo.OrderContent)*@
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-4 control-label">
                    单次剂量
                </label>
                <div class="col-sm-4">
                    @Html.TextBoxFor(model => model.DrugInfo.Dosage, new { id = "DosageInput", @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.DrugInfo.Dosage)
                </div>
                <div class="col-sm-4">
                    @Html.DropDownListFor(model => model.DrugInfo.DosageUnits, Model.Unit(), new { id = "UnitDropDownListInput", @class = "form-control" })
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-4 control-label">
                    开单科室
                </label>
                <div class="col-sm-8">
                    @Html.DropDownListFor(model => model.DrugInfo.DeptCode, Model.DeptList(), new { id = "DeptListDropDownList", @class = "form-control add-chosen" })
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-4 control-label">
                    *给药途径
                </label>
                <div class="col-sm-8">
                    @Html.DropDownListFor(model => model.DrugInfo.Administration, Model.RouteList(), new { id = "RouteDropDownList", @class = "form-control add-chosen" })
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-4 control-label">
                    *开始时间
                </label>
                <div class="col-sm-8">
                    @if (Model.VisitId.Substring(0, 2) == "In")
                    {
                        @Html.TextBoxFor(model => model.DrugInfo.StartDateTime, new { id = "StartDateTimeInput", @onclick = "WdatePicker({minDate:'#F{$dp.$D(FirstDate)}',maxDate:'#F{$dp.$D(LastDate)}',dateFmt:'yyyy-MM-dd HH:mm:ss'})", @class = "form-control" })
                    }
                    else
                    {
                        @Html.TextBoxFor(model => model.DrugInfo.StartDateTime, new { id = "StartDateTimeInput", @onclick = "WdatePicker({minDate:'#F{$dp.$D(FirstDate)}',dateFmt:'yyyy-MM-dd HH:mm:ss'})", @class = "form-control" })                     
                    }
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-4 control-label">
                    *结束时间
                </label>
                <div class="col-sm-8">
                    @if (Model.VisitId.Substring(0, 2) == "In")
                    {
                        @Html.TextBoxFor(model => model.DrugInfo.StopDateTime, new { id = "StopDateTimeInput", @onclick = "WdatePicker({minDate:'#F{$dp.$D(StartDateTimeInput)}',maxDate:'#F{$dp.$D(LastDate)}',dateFmt:'yyyy-MM-dd HH:mm:ss'})", @class = "form-control" })
                    }
                    else
                    {
                        @Html.TextBoxFor(model => model.DrugInfo.StopDateTime, new { id = "StopDateTimeInput", @onclick = "WdatePicker({minDate:'#F{$dp.$D(StartDateTimeInput)}',dateFmt:'yyyy-MM-dd HH:mm:ss'})", @class = "form-control" })                    
                    }
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-4 control-label">
                    *执行频率
                </label>
                <div class="col-sm-2">
                    @Html.TextBoxFor(model => model.DrugInfo.FreqInteval, new { id = "FreqIntevalInput", @class = "form-control" })
                </div>
                <div class="col-sm-3">
                    @Html.DropDownListFor(model => model.DrugInfo.FreqIntevalUnit, Model.FreqUnit2(), new { id = "FreqUnit2DropDownList", @class = "form-control" })
                </div>
                <div class="col-sm-2">
                    @Html.TextBoxFor(model => model.DrugInfo.FreqCounter, new { id = "FreqCounterInput", @class = "form-control" })
                </div>
                <div class="col-sm-1">
                    次
                </div>
               
            </div>
               @*alert弹出框*@
            <div id="alertDrugInfoDiv" style="display: none" class="form-group">
                <div class="col-sm-12">
                    <p id="DrugInfoWarning" style="font-size: 16px; color: #FF0000; font-weight: bold;
                    text-align: center">
                       
                    </p>
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-5 col-sm-7">
                    <input type="button" class="btn btn-primary addDrugInfoBtn" value="添加" />
                </div>
            </div>
        </div>
    </div>
</div>
@*编辑信息*@
<div id="editDataDiv" style="display: none; overflow: none">
    <div class="modalHeader">
        <span>编辑</span></div>
    <div class="modalContent">
        <form class="form-horizontal" role="form">
        <div class="form-group" style="display: none;">
            <label for="OrderNo" class="col-sm-3 control-label">
                编号</label>
            <div class="col-sm-9">
                <input type="text" class="form-control" id="OrderNo" readonly="readonly" />
            </div>
        </div>
        <div class="form-group">
            <label for="OrderClass" class="col-sm-3 control-label">
                *药物类别</label>
            <div class="col-sm-9">
                @*<input type="text" class="form-control" id="OrderClass" readonly="readonly" />*@
                @Html.DropDownListFor(model => model.DrugInfo.OrderClass, Model.DrugTypeList(), new { id = "OrderClass", @class = "form-control chosen" })
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">
                *长期医嘱
            </label>
            <div class="col-sm-3">
                <input type="radio" class="identity" name="ReptFlag2" id="ReptFlagYes2" value="1" />
                <label class="col-sm-1 control-label">
                    是</label>
            </div>
            <div class="col-sm-3">
                <input type="radio" class="identity" name="ReptFlag2" id="ReptFlagNo2" value="2" />
                <label class="col-sm-1 control-label">
                    否</label>
            </div>
        </div>
        <div class="form-group">
            <label for="OrderCode" class="col-sm-3 control-label">
                *药品名称</label>
            <div class="col-sm-9">
                @*<input type="text" class="form-control" id="OrderContent" />*@
                @Html.DropDownListFor(model => model.DrugInfo.OrderCode, Model.DrugNameList(), new { id = "OrderCode", @class = "form-control chosen" })
            </div>
        </div>
        <div class="form-group">
            <label for="Dosage" class="col-sm-3 control-label">
                剂量</label>
            <div class="col-sm-9">
                <input type="text" class="form-control" id="Dosage" />
            </div>
        </div>
        <div class="form-group">
            <label for="DosageUnits" class="col-sm-3 control-label">
                剂量单位</label>
            <div class="col-sm-9">
                @*<input type="text" class="form-control" id="DosageUnits" />*@
                @Html.DropDownListFor(model => model.DrugInfo.DosageUnits, Model.Unit(), new { id = "DosageUnits", @class = "form-control" })
            </div>
        </div>
        <div class="form-group">
            <label for="DeptCode" class="col-sm-3 control-label">
                开单科室</label>
            <div class="col-sm-9">
                @Html.DropDownListFor(model => model.DrugInfo.DeptCode, Model.DeptList(), new { id = "DeptCode", @class = "form-control chosen" })
            </div>
        </div>
        <div class="form-group">
            <label for="Administration" class="col-sm-3 control-label">
                *给药途径</label>
            <div class="col-sm-9">
                @*<input type="text" class="form-control" id="Administration" />*@
                @Html.DropDownListFor(model => model.DrugInfo.Administration, Model.RouteList(), new { id = "Administration", @class = "form-control chosen" })
            </div>
        </div>
        <div class="form-group">
            <label for="StartDateTime" class="col-sm-3 control-label">
                *开始时间</label>
            <div class="col-sm-9">
                @if (Model.VisitId.Substring(0, 2) == "In")
                {
                    @Html.TextBoxFor(model => model.DrugInfo.StartDateTime, new { id = "StartDateTime", @onclick = "WdatePicker({minDate:'#F{$dp.$D(FirstDate)}',maxDate:'#F{$dp.$D(LastDate)}',dateFmt:'yyyy-MM-dd HH:mm:ss'})", @class = "form-control" })
                }
                else
                {
                    @Html.TextBoxFor(model => model.DrugInfo.StartDateTime, new { id = "StartDateTime", @onclick = "WdatePicker({minDate:'#F{$dp.$D(FirstDate)}',dateFmt:'yyyy-MM-dd HH:mm:ss'})", @class = "form-control" })                     
                }
            </div>
        </div>
        <div class="form-group">
            <label for="StopDateTime" class="col-sm-3 control-label">
                *结束时间</label>
            <div class="col-sm-9">
                @if (Model.VisitId.Substring(0, 2) == "In")
                {
                    @Html.TextBoxFor(model => model.DrugInfo.StopDateTime, new { id = "StopDateTime", @onclick = "WdatePicker({minDate:'#F{$dp.$D(StartDateTime)}',maxDate:'#F{$dp.$D(LastDate)}',dateFmt:'yyyy-MM-dd HH:mm:ss'})", @class = "form-control" })
                }
                else
                {
                    @Html.TextBoxFor(model => model.DrugInfo.StopDateTime, new { id = "StopDateTime", @onclick = "WdatePicker({minDate:'#F{$dp.$D(StartDateTime)}',dateFmt:'yyyy-MM-dd HH:mm:ss'})", @class = "form-control" })                    
                }
            </div>
        </div>
        <div class="form-group">
            <label for="FreqCounter" class="col-sm-3 control-label">
                *执行频率</label>
            <div class="col-sm-2">
                <input type="text" class="form-control" id="FreqInteval" />
            </div>
            <div class="col-sm-3">
                @*<input type="text" class="form-control" id="FreqIntevalUnit" />*@
                @Html.DropDownListFor(model => model.DrugInfo.FreqIntevalUnit, Model.FreqUnit2(), new { id = "FreqIntevalUnit", @class = "form-control" })
            </div>
            <div class="col-sm-2">
                <input type="text" class="form-control" id="FreqCounter" />
            </div>
            <div class="col-sm-1">
                次
            </div>
        </div>
        <div class="form-group" style="display: none;" id="DrugInfoTip">
            <div class="col-sm-12">
                <p id="DrugInfoEditWarning" style="font-size: 16px; color: #FF0000; font-weight: bold;
                    text-align: center">
                </p>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-offset-4 col-sm-12">
                <input type="button" class="btn btn-primary saveDrugInfoBtn" value="保存" />
                <input type="button" class="btn btn-default simplemodal-close" id="cancel" value="取消" />
            </div>
        </div>
        </form>
    </div>
</div>
@*删除信息*@
<div id="DeleteDataDiv" style="display: none;">
    <div class="modalHeader">
        <span>删除</span></div>
    <div class="modalContent">
        <form class="form-horizontal" role="form">
        <p>
            确定删除？</p>
        <table>
            <tr>
                <td>
                    <input type="button" class="btn btn-primary sureDeleteBtn" value="确定" />
                </td>
                <td>
                    <input type="button" class="btn btn-default simplemodal-close" id="cancelDelete"
                        value="取消" />
                </td>
            </tr>
        </table>
        </form>
    </div>
</div>
@*页面跳转*@
<div style="float: right">
    <ul id="Redirect">
        <li>@Ajax.ActionLink("上一步", "LabTestInfo", new { UserId = @Model.UserId, VisitId = @Model.VisitId }, new AjaxOptions { OnSuccess = "tabClick4();", UpdateTargetId = "ShowClinicalProfileInfo", InsertionMode = InsertionMode.Replace })</li>
        @*<li>@Ajax.ActionLink("完成", "DrugInfo", new AjaxOptions { OnSuccess = "success6();", UpdateTargetId = "ShowClinicalProfileInfo", InsertionMode = InsertionMode.Replace })</li>*@
        <li>@Html.ActionLink("下一步", "ModuleProfile", "DoctorHome", new { PatientId = @Model.UserId }, null)</li>
    </ul>
</div>
<script type="text/javascript">
    var table5 = $('#DrugInfoList').DataTable({
        "oLanguage": {//语言国际化
            "sUrl": "/Content/jquery.dataTable.cn.txt"
        },
        "bAutoWidth": true,
        "bPaginate": false,  //是否分页。
        "sScrollX": "100%",
        "sScrollY": "300px",
        "bFilter": true,
        "aaSorting": [[9, "desc"]],
        "columnDefs": [{
            "bSortable": false, "aTargets": [15, 16]
        }, {
            "targets": [0],
            "visible": false,
            "searchable": false
        }, {
            "targets": [1],
            "visible": false,
            "searchable": false
        }, {
            "targets": [2],
            "visible": false,
            "searchable": false
        }, {
            "targets": [5],
            "visible": false,
            "searchable": false
        }, {
            "targets": [7],
            "visible": false,
            "searchable": false
        }, {
            "targets": [8],
            "visible": false,
            "searchable": false
        }, {
            "targets": [11],
            "visible": false,
            "searchable": false
        }, {
            "targets": [12],
            "visible": false,
            "searchable": false
        }, {
            "targets": [13],
            "visible": false,
            "searchable": false
        }, {
            "targets": [14],
            "visible": false,
            "searchable": false
        }, {
            "targets": [17],
            "visible": false,
            "searchable": false
        }, {
            "targets": [18],
            "visible": false,
            "searchable": false
        }]
    });
    $("#DrugInfoList").attr("width", "auto");

    $(document).ready(function () {
        document.getElementById("DrugTypeDropDownList").value = "";
        document.getElementById("UnitDropDownListInput").value = "";
        document.getElementById("RouteDropDownList").value = "";
        document.getElementById("FreqUnit2DropDownList").value = "";
        document.getElementById("DeptListDropDownList").value = "";
        document.getElementById("OrderCodeInput").value = "";

        var UserId = document.getElementById("UId").value;
        var VisitId = "@Model.VisitId";
        var trSeq;
        var dataindex = 0;
        var OrderNo = 0;
        var RepeatIndicator = 0;

        $(".addDrugInfo").click(function () {
            $('#addDrugInfoDiv').modal({
                closeHTML: "<a href='#' title='Close' class='modal-close'>x</a>",
                overlayClose: true     //点击蒙层关闭窗口
            });

            $('.add-chosen').chosen({
                no_results_text: "没有找到相应的选项",
                placeholder_text: "请选择"
            });
        })

        //        $("#TableBody").ajaxComplete(function () { //待请求完成时 执行 
        $(document).on("click", ".editDrugInfoBtn", function () {
            dataindex = table5.row($(this).parent().parent()).index();
            table5.column(0).visible(true);
            table5.column(1).visible(true);
            table5.column(2).visible(true);
            table5.column(5).visible(true);
            table5.column(7).visible(true);
            table5.column(8).visible(true);
            table5.column(11).visible(true);
            table5.column(12).visible(true);
            table5.column(13).visible(true);
            table5.column(14).visible(true);
            table5.column(17).visible(true);
            table5.column(18).visible(true);
            trSeq = $(this).parent().parent().parent().find("tr").index($(this).parent().parent());
            var OrderNo = $("#TableBody tr:eq(" + trSeq + ") td:eq(0)").text().trim();
            var OrderSubNo = $("#TableBody tr:eq(" + trSeq + ") td:eq(1)").text().trim();
            var OrderClass = $("#TableBody tr:eq(" + trSeq + ") td:eq(2)").text().trim();
            var OrderContent = $("#TableBody tr:eq(" + trSeq + ") td:eq(3)").text().trim();
            var Dosage = $("#TableBody tr:eq(" + trSeq + ") td:eq(4)").text().trim();
            var DosageUnits = $("#TableBody tr:eq(" + trSeq + ") td:eq(5)").text().trim();
            var DosageUnitsText = $("#TableBody tr:eq(" + trSeq + ") td:eq(6)").text().trim();
            var Administration = $("#TableBody tr:eq(" + trSeq + ") td:eq(7)").text().trim();
            var RepeatIndicator = $("#TableBody tr:eq(" + trSeq + ") td:eq(8)").text().trim();
            var StartDateTime = $("#TableBody tr:eq(" + trSeq + ") td:eq(9)").text().trim();
            var StopDateTime = $("#TableBody tr:eq(" + trSeq + ") td:eq(10)").text().trim();
            var FreqCounter = $("#TableBody tr:eq(" + trSeq + ") td:eq(11)").text().trim();
            var Frequency = $("#TableBody tr:eq(" + trSeq + ") td:eq(12)").text().trim();
            var FreqInteval = $("#TableBody tr:eq(" + trSeq + ") td:eq(13)").text().trim();
            var FreqIntevalUnit = $("#TableBody tr:eq(" + trSeq + ") td:eq(14)").text().trim();
            var DeptCode = $("#TableBody tr:eq(" + trSeq + ") td:eq(17)").text().trim();
            var OrderCode = $("#TableBody tr:eq(" + trSeq + ") td:eq(18)").text().trim();
            table5.column(0).visible(false);
            table5.column(1).visible(false);
            table5.column(2).visible(false);
            table5.column(5).visible(false);
            table5.column(7).visible(false);
            table5.column(8).visible(false);
            table5.column(11).visible(false);
            table5.column(12).visible(false);
            table5.column(13).visible(false);
            table5.column(14).visible(false);
            table5.column(17).visible(false);
            table5.column(18).visible(false);
            EditData(OrderNo, OrderSubNo, OrderClass, OrderContent, Dosage, DosageUnits, DosageUnitsText, Administration, RepeatIndicator, StartDateTime, StopDateTime, FreqCounter, Frequency, FreqInteval, FreqIntevalUnit, DeptCode, OrderCode);

            $('.chosen').chosen({
                no_results_text: "没有找到相应的选项",
                placeholder_text: "请选择"
            });
        });

        //编辑数据界面
        function EditData(OrderNo, OrderSubNo, OrderClass, OrderContent, Dosage, DosageUnits, DosageUnitsText, Administration, RepeatIndicator, StartDateTime, StopDateTime, FreqCounter, Frequency, FreqInteval, FreqIntevalUnit, DeptCode, OrderCode) {
            document.getElementById("OrderNo").value = OrderNo;
            document.getElementById("OrderClass").value = OrderClass;
            //document.getElementById("OrderContent").value = OrderContent;
            document.getElementById("Dosage").value = Dosage;
            document.getElementById("DosageUnits").value = DosageUnits;
            document.getElementById("Administration").value = Administration;
            document.getElementById("StartDateTime").value = StartDateTime;
            document.getElementById("StopDateTime").value = StopDateTime;
            document.getElementById("FreqCounter").value = FreqCounter;
            //document.getElementById("Frequency").value = Frequency;
            document.getElementById("FreqInteval").value = FreqInteval;
            document.getElementById("FreqIntevalUnit").value = FreqIntevalUnit;
            document.getElementById("DeptCode").value = DeptCode;
            document.getElementById("OrderCode").value = OrderCode;
            var temp = document.getElementsByName("ReptFlag2");
            for (i = 0; i < temp.length; i++) {
                //遍历Radio
                if (temp[i].value == RepeatIndicator) {
                    //设置选中值
                    temp[i].checked = true;
                }
            }

            $('#editDataDiv').modal({
                closeHTML: "<a href='#' title='Close' class='modal-close'>x</a>",
                overlayClose: true     //点击蒙层关闭窗口
            });
        }



        $(".saveDrugInfoBtn").click(function () {
            //var OrderNo = $("#TableBody tr:eq(" + trSeq + ") td:eq(0)").text().trim();
            var OrderNo = document.getElementById("OrderNo").value;
            //var OrderSubNo = document.getElementById("OrderSubNo").value;
            var OrderSubNo = 1;
            var OrderClass = document.getElementById("OrderClass").value;
            var OrderCode = document.getElementById("OrderCode").value;
            var Dosage = document.getElementById("Dosage").value;
            var DosageUnitsCode = document.getElementById("DosageUnits").value;
            var DosageUnits = document.getElementById("DosageUnits").options[document.getElementById("DosageUnits").selectedIndex].text;
            //var DosageUnits = document.getElementById("DosageUnits").value;
            var Administration = document.getElementById("Administration").value;
            //var RepeatIndicatorCode = document.getElementById("Administration").value;
            var StartDateTime = document.getElementById("StartDateTime").value;
            var StopDateTime = document.getElementById("StopDateTime").value;
            var FreqCounter = document.getElementById("FreqCounter").value;
            //var Frequency = document.getElementById("Frequency").value;
            var Frequency = "";
            var FreqInteval = document.getElementById("FreqInteval").value;
            var FreqIntevalUnit = document.getElementById("FreqIntevalUnit").value;
            //alert(StartDateTime);
            var DeptCode = document.getElementById("DeptCode").value;
            var temp = document.getElementsByName("ReptFlag2");
            var RepeatIndicator = "3";
            for (i = 0; i < temp.length; i++) {
                //遍历Radio
                if (temp[i].checked) {
                    //获取Radio的值
                    RepeatIndicator = temp[i].value;
                }
            }

            if (RepeatIndicator == "3" || OrderClass == "" || OrderCode == "" || StartDateTime == "" || StopDateTime == "" || Administration == "" || FreqCounter == "" || FreqInteval == "" || FreqIntevalUnit == "") {
                var Text = "提示：";
                if (RepeatIndicator == "3") { Text = Text + "长期医嘱 "; }
                if (OrderClass == "") { Text = Text + "药物类型 "; }
                if (OrderCode == "") { Text = Text + "药品名称 "; }
                if (StartDateTime == "") { Text = Text + "开始时间 "; }
                if (StopDateTime == "") { Text = Text + "结束时间 "; }
                if (Administration == "") { Text = Text + "给药途径 "; }
                if (FreqCounter == "" || FreqInteval == "" || FreqIntevalUnit == "") { Text = Text + "执行频率 "; }

                Text = Text + "不能为空！";
                $("#DrugInfoEditWarning").html(Text);
                //alert(Text);
                $('#DrugInfoTip').show();
            }
            else {
                var OrderContent = document.getElementById("OrderCode").options[document.getElementById("OrderCode").selectedIndex].text;
                $.ajax({
                    url: "/DoctorHome/DrugInfoEdit",
                    type: "GET",
                    dataType: "json",
                    async: false,
                    data: { UserId: UserId, VisitId: VisitId, OrderNo: OrderNo, OrderSubNo: OrderSubNo, OrderClass: OrderClass, RepeatIndicator: RepeatIndicator, OrderCode: OrderCode, OrderContent: OrderContent, Dosage: Dosage, DosageUnitsCode: DosageUnitsCode, Administration: Administration, StartDateTime: StartDateTime, StopDateTime: StopDateTime, FreqCounter: FreqCounter, Frequency: Frequency, FreqInteval: FreqInteval, FreqIntevalUnit: FreqIntevalUnit, DeptCode: DeptCode },  //输入参数
                    success: function (res) {
                        if (res == true) {
                            $("#cancel").click();
                            table5.row(dataindex).remove().draw();
                            table5.row.add({
                                "0": OrderNo,
                                "1": OrderSubNo,
                                "2": OrderClass,
                                "3": OrderContent,
                                "4": Dosage,
                                "5": DosageUnitsCode,
                                "6": DosageUnits,
                                "7": Administration,
                                "8": RepeatIndicator,
                                "9": StartDateTime,
                                "10": StopDateTime,
                                "11": FreqCounter,
                                "12": Frequency,
                                "13": FreqInteval,
                                "14": FreqIntevalUnit,
                                "15": "<input type='button' value='编辑' class='btn btn-primary editDrugInfoBtn' />",
                                "16": "<input type='button' value='删除' class='btn btn-primary deleteDrugInfoBtn' />",
                                "17": DeptCode,
                                "18": OrderCode
                            }).draw();
                        }
                        else {
                            alert("数据修改失败，请重新输入！");
                        }
                    }
                })
            }
        })
        //        })

        $(".addDrugInfoBtn").click(function () {
            var tbody = document.getElementById("TableBody");
            //            if (document.getElementById("NotExist")) {//存在 
            //                var tr = document.getElementById("NotExist");
            //                tbody.removeChild(tr);
            //            }

            if ($("#TableBody tr").length == 1) {
                if ($("#TableBody tr:first td").length == 1) {
                    $("#TableBody").empty();
                }
                //alert("12");
            }

            //var OrderNo = parseInt(document.getElementById("MaxOrderNo").value) + addNo + 1;
            var OrderNo = Number(document.getElementById("MaxOrderNo").value) + 1;
            //alert(OrderNo);
            var OrderSubNo = 1;
            var OrderClass = document.getElementById("DrugTypeDropDownList").value;
            //获取radio的选中值
            var temp = document.getElementsByName("ReptFlag");
            var RepeatIndicator = "3";
            for (i = 0; i < temp.length; i++) {
                //遍历Radio
                if (temp[i].checked) {
                    //获取Radio的值
                    RepeatIndicator = temp[i].value;
                }
            }
            var OrderCode = document.getElementById("OrderCodeInput").value;
            //alert(OrderCode);
            var Dosage = document.getElementById("DosageInput").value;
            var DosageUnits = document.getElementById("UnitDropDownListInput").value;
            var Administration = document.getElementById("RouteDropDownList").value;
            var StartDateTime = document.getElementById("StartDateTimeInput").value;
            var StopDateTime = document.getElementById("StopDateTimeInput").value;
            var FreqCounter = document.getElementById("FreqCounterInput").value;
            //var FreqCounterUnit = document.getElementById("FreqUnitDropDownList").value;
            var Frequency = "0";
            var FreqInteval = document.getElementById("FreqIntevalInput").value;
            var FreqIntevalUnit = document.getElementById("FreqUnit2DropDownList").value;
            var DeptCode = document.getElementById("DeptListDropDownList").value;


            if (RepeatIndicator == "3" || OrderClass == "" || OrderCode == "" || StartDateTime == "" || StopDateTime == "" || Administration == "" || FreqCounter == "" || FreqInteval == "" || FreqIntevalUnit == "") {
                var Text = "提示：";
                if (RepeatIndicator == "3") { Text = Text + "长期医嘱 "; }
                if (OrderClass == "") { Text = Text + "药物类型 "; }
                if (OrderCode == "") { Text = Text + "药品名称 "; }
                if (StartDateTime == "") { Text = Text + "开始时间 "; }
                if (StopDateTime == "") { Text = Text + "结束时间 "; }
                if (Administration == "") { Text = Text + "给药途径 "; }
                if (FreqCounter == "" || FreqInteval == "" || FreqIntevalUnit == "") { Text = Text + "执行频率 "; }

                Text = Text + "不能为空！";
                $("#DrugInfoWarning").html(Text);
                $("#alertDrugInfoDiv").show();
                //alert(Text);
                //                $('#alertDiv').modal({
                //                    closeHTML: "<a href='#' title='Close' class='modal-close'>x</a>",
                //                    containerId: 'alert-container',
                //                    overlayClose: true     //点击蒙层关闭窗口
                //                });
            }
            else {
                if (DosageUnits == "") {
                    DosageUnits = "";
                }
                if (Administration == "") {
                    Administration = "0";
                }
                if (FreqIntevalUnit == "") {
                    FreqIntevalUnit = "0";
                }
                if (Dosage == "") {
                    Dosage = "0";
                }
                if (FreqCounter == "") {
                    FreqCounter = "0";
                }
                if (FreqInteval == "") {
                    FreqInteval = "0";
                }
                //alert(Administration);
                var OrderContent = document.getElementById("OrderCodeInput").options[document.getElementById("OrderCodeInput").selectedIndex].text;
                $.ajax({
                    url: "/DoctorHome/DrugInfoAdd",
                    type: "GET",
                    dataType: "json",
                    async: false,
                    data: { UserId: UserId, VisitId: VisitId, OrderSubNo: OrderSubNo, OrderClass: OrderClass, RepeatIndicator: RepeatIndicator, OrderCode: OrderCode, OrderContent: OrderContent, Dosage: Dosage, DosageUnits: DosageUnits, Administration: Administration, StartDateTime: StartDateTime, StopDateTime: StopDateTime, FreqCounter: FreqCounter, Frequency: Frequency, FreqInteval: FreqInteval, FreqIntevalUnit: FreqIntevalUnit, DeptCode: DeptCode },  //输入参数
                    success: function (res) {
                        if (res == true) {
                            $("#MaxOrderNo").attr("value", OrderNo);
                            if (DosageUnits != "") {
                                var Data_6 = document.getElementById("UnitDropDownListInput").options[document.getElementById("UnitDropDownListInput").selectedIndex].text;
                            }
                            else {
                                var Data_6 = "";
                            }
                            table5.row.add({
                                "0": OrderNo,
                                "1": OrderSubNo,
                                "2": OrderClass,
                                "3": OrderContent,
                                "4": Dosage,
                                "5": DosageUnits,
                                "6": Data_6,
                                "7": Administration,
                                "8": RepeatIndicator,
                                "9": StartDateTime,
                                "10": StopDateTime,
                                "11": FreqCounter,
                                "12": "",
                                "13": FreqInteval,
                                "14": FreqIntevalUnit,
                                "15": "<input type='button' value='编辑' class='btn btn-primary editDrugInfoBtn' />",
                                "16": "<input type='button' value='删除' class='btn btn-primary deleteDrugInfoBtn' />",
                                "17": DeptCode,
                                "18": OrderCode
                            }).draw();
                            document.getElementById("DrugTypeDropDownList").value = "";
                            document.getElementById("OrderCodeInput").value = "";
                            document.getElementById("DosageInput").value = "";
                            document.getElementById("UnitDropDownListInput").value = "";
                            document.getElementById("RouteDropDownList").value = "";
                            document.getElementById("StartDateTimeInput").value = "";
                            document.getElementById("StopDateTimeInput").value = "";
                            document.getElementById("FreqCounterInput").value = "";
                            document.getElementById("FreqIntevalInput").value = "";
                            document.getElementById("FreqUnit2DropDownList").value = "";
                            document.getElementById("DeptListDropDownList").value = "";
                            $("#cancel").click();
                        }
                        else {
                            alert("数据插入失败，请重新输入！");
                        }
                    }
                })
            }
        })

        $(document).on("click", ".deleteDrugInfoBtn", function () {
            dataindex = table5.row($(this).parent().parent()).index();
            trSeq = $(this).parent().parent().parent().find("tr").index($(this).parent().parent());
            $('#DeleteDataDiv').modal({
                closeHTML: "<a href='#' title='Close' class='modal-close'>x</a>",
                containerId: 'delete-container',
                overlayClose: true     //点击蒙层关闭窗口
            });
        });

        $(".sureDeleteBtn").click(function () {
            table5.column(0).visible(true);
            table5.column(1).visible(true);
            var OrderNo = $("#TableBody tr:eq(" + trSeq + ") td:eq(0)").text().trim();
            var OrderSubNo = $("#TableBody tr:eq(" + trSeq + ") td:eq(1)").text().trim();
            $.ajax({
                url: "/DoctorHome/DrugInfoDelete",
                type: "GET",
                dataType: "json",
                async: false,
                data: { UserId: UserId, VisitId: VisitId, OrderNo: OrderNo, OrderSubNo: OrderSubNo },  //输入参数
                success: function (res) {
                    if (res == true) {
                        $("#cancelDelete").click();
                        var tbody = document.getElementById("TableBody");
                        tbody.deleteRow(trSeq);
                        table5.row(dataindex).remove().draw();
                    }
                    else {
                        alert("数据删除失败，请重试！");
                    }
                }
            })
            var max = 0;
            for (i = 0; i < table5.column(0).data().length; i++) {
                if (max < parseInt($("#TableBody tr:eq(" + i + ") td:eq(0)").text().trim())) {
                    max = parseInt($("#TableBody tr:eq(" + i + ") td:eq(0)").text().trim());
                }
            }
            $("#MaxOrderNo").attr("value", max);
            table5.column(0).visible(false);
            table5.column(1).visible(false);
        })
    });



    String.prototype.trim = function () {
        return this.replace(/(^\s*)|(\s*$)/g, "");
    }


    $(document).ready(function () {
        //鼠标移动到行变色,单独建立css类hover
        //tr:gt(0):表示获取大于 tr index 为0 的所有tr，即不包括表头
        $("#TableBody tr").hover(
        function () {
            $(this).addClass("tdhover")
        },
        function () {
            $(this).removeClass("tdhover")
        })
    });
</script>
